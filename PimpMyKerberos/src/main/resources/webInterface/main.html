<html>
	<head>
	   <script src="javascript/utils.js"></script>
	   <title>PimpMyKerberos</title>
	   <link rel="stylesheet" type="text/css" href="css/semantic.css"/>
	   <link rel="stylesheet" type="text/css" href="css/main.css"/>
	   <link rel="stylesheet" type="text/css" href="css/calendar.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/Chart.css"/>
 	   

	
		<script>

		var timeLineJson="";
		var displayMenu=0;
		var nightMode=0;
		var core;
		var mute=0;
		var timeLineId=1;
		var chart="";
		var canvas="";
		var camData; var datasets;
		var ctx="";
		var lastScrollTop = 0;
		
		// Affichage peripheriques des videos, on chargera les x timeline au dessus et en dessous, les autres seront mises à src="" pour décharger la mémoire
		var peripheralDisplay=3;

			
		var dynamicColors = function () {
 				   var r = Math.floor(Math.random() * 255);
    			   var g = Math.floor(Math.random() * 255);
    			   var b = Math.floor(Math.random() * 255);
    			  return "rgb(" + r + "," + g + "," + b + ")";
		}
		const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour :'numeric', minute:'numeric',second: 'numeric' };
		const colorChart = ["rgba(53,166,155,0.6)","rgba(255,62,128,0.6)","rgba(154,255,210,0.6)","rgba(255,191,0,0.6)","rgba(143,73,255,0.6)","rgba(75,255,255,0.6)","rgba(51,0,153,0.6)",dynamicColors(),dynamicColors(),dynamicColors(),dynamicColors(),dynamicColors(),dynamicColors(),dynamicColors(),dynamicColors(),dynamicColors(),dynamicColors(),dynamicColors(),dynamicColors()];
		
		function display(id){
				//console.log("Can display now " + id);
			    document.getElementById(id).style.display="block";
			    document.getElementById("wait_" + id).style.display="none";
			}
		
		
		$(document).ready(function() {
		
		
			$("html, body").animate({ scrollTop: 0 }, "slow");
			loadCore();
			WebSocketClient.open(url("hello")); 
			reloadMemory();reloadSpace();loadLiveCamera();setNightMode(nightMode);
			loadStoreCamera(true,"");
		
			setInterval(reloadMemory, 10000);
			setInterval(displayTime, 1000);
			setInterval(reloadSpace, 10000);
			setInterval(garbageTimeCollector,10000);
			
			$("#calendar").datepicker(
				{
					onSelect: function(dateText) {
								     			    console.log("Selected date: " + dateText + "; input's current value: " + this.value);
													getValueFromUrl("camera?action=fromDay&date="+ dateText,true,function (json){
																try {
																	timeLineJson=JSON.parse(json);
																	console.log("from picker " + timeLineJson);
																	loadStoreCamera(true,"");	
																	}
																	catch (e)
																	{
																		console.log(e);
																	}
													});
											    } 
				}
			);
			$("#calendar").datepicker("option","dateFormat","yy-mm-dd");
			
			$('#muteCheck').checkbox().checkbox({
					    onChecked: function() {
							      				mute=1;
												getValueFromUrl("admin?action=setMuteMode&muteMode=1",true);
											  },
					    onUnchecked: function() {
											     mute=0;
												getValueFromUrl("admin?action=setMuteMode&muteMode=0",true);
												}
									});
    
			
			$('#nightCheck').checkbox().checkbox({
					    onChecked: function() {
							      				setNightMode(1);
												
												getValueFromUrl("admin?action=setNightMode&nightMode=1",true);
											  },
					    onUnchecked: function() {
											   setNightMode(0);
												getValueFromUrl("admin?action=setNightMode&nightMode=0",true);
												}
									});
			
			
			
			$("body").delegate(".browsable", "click", function(){
							
							name=$(this).attr("name");
							$("#pathHeader").html(name);
							getValueFromUrl("camera?action=getDir&sub=" + name,true,function (json)
							{
								directoryJson=JSON.parse(json);
								try {
									html="";
									for (i=0;i<directoryJson.length;i++)
									{
										directory=directoryJson[i];
										html+="<div style=width:500px class=\"item\"><i name=\"" + directory.name + "\" class=\"browsable folder icon\"></i><div class=\"content\"><div class=\"header\">" + directory.name + "</div></div></div>";										
									}
									$("#items").html(html);
								} catch (e)
								{
									top.location.href="/";
								}
								
							});
								    
		    });
		
			$("#logout").click(function(e){
				getValueFromUrl("admin?action=logout",true,function (){
					top.location.href="/";
				});
			});
			
			
			
			$("#closeDashAI").click(function(e){
				$("#dashai").hide();
			});

			$("#trainModelButton").click(function(e){
				$("#trainModel").show();
				
			});

			$("#engineButton").click(function(e){
				
				
				window.open("http://" +window.location.hostname + ":9000");
				
			});


			
			$("#reloadButton").click(function(e){
				button=$(this);
				$("html, body").animate({ scrollTop: 0 }, "slow");
				button.addClass("loading");
				timeLineJson="";
				loadStoreCamera(true,"");	
				button.removeClass("loading");
				$("#reloadMessage").transition('fade down')
				setNightMode(nightMode);
			});
			
			$("#declineButton").click(function(e){
				$("#reloadMessage").transition('fade down')
			});
			
			$("#ai").click(function(e){
				$("#dashai").show();
				$("#menu").transition('fly left');
			});
			
			$("#muteButton").click(function(e){
				$("#reloadMessage").transition('fade down');
				$('#muteCheck').checkbox('set checked');
				mute=1;
				$("#menu").transition('fly left');
				displayMenu=1;
				$('#muteCheck').transition('flash');
				$('#muteCheck').css('position','absolute');
				$('#muteCheck').css('left','3px');
				getValueFromUrl("admin?action=setMuteMode&muteMode=1",true);
			});
			
			
			function hoursEarlier(hours) {
  				return moment().subtract(hours, 'h').toDate();
			};
		
			
			$("#hideChartModal").click(function (e){
					$("#showChartModal").transition('slide down');
				
			});
			
			$("#showChart").click(function (e){
				datasets=new Array();
				ctx = document.getElementById('myChart').getContext('2d');
				
				
				getValueFromUrl("camera?action=getFileByHour",true,function(json){
													
				try {
					fileByHourJson=JSON.parse(json);
					//console.log(fileByHourJson);
					i=0;
					for (let camName of  Object.keys(fileByHourJson.camMap)) {
						  //console.log(camName); 
						  camera=fileByHourJson.camMap[camName];
						  //console.log(camera);
						  datas=new Array();
						  for (let aTime of  Object.keys(fileByHourJson.camMap[camName])) {
							  
							  //console.log("time:" + aTime.substr(0,10));
							  aDate = new Date(parseInt(aTime.substr(0,10) * 1000));
							  //console.log("aDate:" + aDate);
							  //console.log("count:" + fileByHourJson.camMap[camName][aTime]);
							  aMeasure={
								 		x: aDate,
										y:fileByHourJson.camMap[camName][aTime]
										}
							  datas.push(aMeasure);
							}
						 
						   dataset=	{
									label: camName,
									data: datas,
									lineTension: 0.25,
								    fill: true,
								    borderColor: colorChart[i],
								    backgroundColor: colorChart[i],
								    //pointBorderColor: 'orange',
								    //pointBackgroundColor: 'rgba(255,150,0,0.5)',
								    //borderDash: [5, 5],
								    pointRadius: 5,
								    pointHoverRadius: 10,
								    pointHitRadius: 30,
								    pointBorderWidth: 2,
								    pointStyle: 'rectRounded'
									} 
						   datasets.push(dataset);
						i++;
						}
					
					
					}
				catch (e)
				 	{
					console.log(e);
					}
				
				camData = {
				datasets: datasets
				};
				
				
				
				var chartOptions = {
					
									tooltips: {
									           callbacks: {
									               label: function(tooltipItem, chart) {
														//console.log(tooltipItem);
														aDate=camData.datasets[tooltipItem.datasetIndex].data[tooltipItem.index]
														return tooltipItem.yLabel + ' file(s)';
									                }
									            }
									        },
					
					
								  legend: {
								    display: true,
								    position: 'top',
								    labels: {
								      boxWidth: 80,
								      fontColor: 'grey'
								    }
								  },
								  scales: {
								    xAxes: [{
								      type: "time",
		 							  distribution: 'linear',
								      time: {
								        unit: 'hour',
								        unitStepSize: 1,
								        round: 'hour',
								        tooltipFormat: "HH:mm",
								        displayFormats: {
								          hour: 'DD/MM HH:mm'
								        }
								      }
								    }],
								    yAxes: [{
								      gridLines: {
								        color: "grey",
								        borderDash: [2, 5],
								      },
								      scaleLabel: {
								        display: true,
								        labelString: "Files recorded",
								        fontColor: "grey"
								      }
								    }]
								  }
								};

				//Compute Chart
				console.log("Reset chart ? " + chart);
				if ( chart != ""){
					console.log("Reset chart ");
					chart.datas=camData;
					chart.update();
					
				}else
				{
					
					
					canvas=document.getElementById('myChart');
								canvas.onclick = function(evt) {
								  var activePoint = chart.getElementAtEvent(event);
								
														  // make sure click was on an actual point
														  if (activePoint.length > 0) {
														    var clickedDatasetIndex = activePoint[0]._datasetIndex;
														    var clickedElementindex = activePoint[0]._index;
														    var value = chart.data.datasets[clickedDatasetIndex].data[clickedElementindex];    
															timeLineJson=""; 
															loadStoreCamera(true,"&startCrunch=" +Date.parse(value.x));
														    //alert();
														  }
								}
								
					chart = new Chart(ctx, {
							    type: 'line',
								data: camData,
								options: chartOptions
							});
							chart.render();
				}
				
				$('#showChartModal').transition('slide down');
				
				toggleMenu();
				});
 			});
			
			$("#cleanAll").click(function(e){
				button=$(this);
				button.addClass("loading");
				getValueFromUrl("camera?action=cleanAll",true,function (value){
					button.removeClass("loading");	
					timeLineJson="";
					reloadSpace();
					loadStoreCamera(true,"");	
					$('#purgeCounter').html(value + "  purged file(s).");
					$('#purgeCount').modal('show');
				});
			});
			
			$("body").delegate(".cleanable", "click", function(){
				button=$(this);
				button.addClass("loading");
				id=$(this).attr("id");
				getValueFromUrl("camera?action=cleanCam&id="+ id,true,function (value){
					button.removeClass("loading");
					timeLineJson="";
					reloadSpace();
					loadStoreCamera(true,"");	
					$('#purgeCounter').html(value+ "  purged file(s).");
					$('#purgeCount').modal('show');
				});
			});
			
			$("body").delegate(".purgeable", "click", function(){
				button=$(this);
				button.addClass("loading");
				id=$(this).attr("id");
				name=$(this).attr("name");
				getValueFromUrl("camera?action=purgeFile&id="+ id,true,function (value){
					button.removeClass("loading");
					console.log("Cleaning " + name);
					$("body").find("." + name).remove();
				});
			});
			
			$("body").delegate(".trainable", "click", function(){
				button=$(this);
				button.addClass("loading");
				id=$(this).attr("id");
				name=$(this).attr("name");
				getValueFromUrl("camera?action=trainCam&id="+ id,true,function (value){
					button.removeClass("loading");
					
				});
			});
			
			$("body").delegate(".keepable", "click", function(){
				button=$(this);
				button.addClass("loading");
				id=$(this).attr("id");
				name=$(this).attr("name");
				getValueFromUrl("camera?action=keepCam&id="+ id,true,function (value){
					button.hide();
				});
			});
			
			$("body").delegate(".seekable", "click", function(){
				button=$(this);
				button.addClass("loading");
				id=$(this).attr("id");
				getValueFromUrl("camera?action=seek&id="+ id,true,function (json){
					try {
						timeLineJson=JSON.parse(json);
						console.log(timeLineJson);
						loadStoreCamera(true,"");	
						}
						catch (e)
						{
							console.log(e);
						}
					
					button.removeClass("loading");	
				});
			});
			
			function displayTime()
			{
				$("#time").html(new Date().toLocaleDateString(undefined, options) );
			}
			
			function setNightMode(aNightMode)
			{
				nightMode=aNightMode;
				if ( nightMode == 1 )
				 {
					$('body').css("background-color","black");
					$('#cameraHeader').css("background-color","black");
					$('#fond').css("background-color","black");
					$('#camContent').css("background-color","black");
					
					$('#spaceBlock').css("background-color","black");
					$('#spaceMemory').css("background-color","black");
					$('#memoryColor').css("color","white");
					$('#spaceColor').css("color","white");
					$("body").find(".dateEvt").css("color","white");
					$("body").find(".loadMore").css("background-color","black");
					$("body").find(".loadMore").css("color","white");
					$('#time').css("color","white");
					$('#showChartModal').css("background-color","black");
				}else
				{					 
				    $('body').css("background-color","white");
					$('#cameraHeader').css("background-color","white");
					$('#fond').css("background-color","white");
					$('#camContent').css("background-color","white");
					
					$('#spaceBlock').css("background-color","white");
					$('#spaceMemory').css("background-color","white");
					$('#memoryColor').css("color","black");
					$('#spaceColor').css("color","black");
					$("body").find(".dateEvt").css("color","black");
					$("body").find(".loadMore").css("background-color","white");
					$("body").find(".loadMore").css("color","black");
					$('#time').css("color","black");
					$('#showChartModal').css("background-color","white");
				}
			}
			
			function loadCore()
			{
				getValueFromUrl("admin?action=getCore",true,function(json){
											try {
													core=JSON.parse(json);
													mute=core.muteMode;
 												    nightMode=core.nightMode;
													$("#paypal").html("<i onclick=javascript:window.open('" + core.paypal + "') id=paypal class=\"paypal icon\"></i>");
													if ( mute == 1 )
													{
														$('#muteCheck').checkbox('set checked');
													}
													if ( nightMode == 1)
													{
														$('#nightCheck').checkbox('set checked');
													}
												} catch (e)
												{
													console.log(e);
												}
							}
				);
			}
		
			function garbageTimeCollector()
			{

				$("body").find(".forceDisplay").show();
				$("body").find(".waitingPimp").hide();
				setNightMode(nightMode);
			}
			
			function distance(element){
				var mustBeLoad=new Array();
				try {
					 var scroll = parseInt(jQuery( "body" ).scrollTop());
					  var win_height = parseInt(jQuery( window ).height());
					  var win= parseInt(win_height+scroll);
					  var elem=parseInt(parseInt(jQuery("#" + element).offset().top) + parseInt(jQuery("#" + element).css("height"))) ;
					  //console.log(element + " win=" + win + " elem=" + elem + " win_height=" + win_height);
					  return (Math.abs(elem - win));
			
			
					} catch (e)
					{
					  console.log(e);
					}
					return  9999999999;
					  //if (win<elem) {
			}
			
			window.addEventListener('mousewheel', function(e){
				    wDelta = e.wheelDelta < 0 ? 'down' : 'up';
				    console.log(wDelta);
					// Looking for the nearest element
					minDistance=9999999999;
					nearest=1;
					$(body).find(".loadMore").each(function (i){
						id=$(this).attr("id");
						name=$(this).attr("name");
						aDistance=distance(id);
						//console.log("id:" + id + " distance from scroll " + aDistance);
						if ( aDistance < minDistance)
						 {
						  minDistance=aDistance;
				          nearest=name;
						 }
					});
					
					console.log("Nearest is " + nearest );
					loadNearest(nearest);
					
					if ( ($(".loadMore").last().offset().top - 1000)  < $(window).scrollTop())
					{
							
								
								console.log("Complete Reload and timeLineId " + timeLineId);
								loadStoreCamera(false,"");
								/*
								var previous=timeLineId - 1;
								$('.timeLine' + previous).each(function(num,val){
			   						 $(this).attr('name', $(this).attr('src'));
								     $(this).attr('src', '')
								});
								*/
							}
						
						//$(".loadMore").last().remove();
					
					
					});
			
				function loadNearest(nearest)
				{
					nearest=parseInt(nearest);
					var minElement=parseInt(parseInt(nearest) - parseInt(peripheralDisplay));
					var maxElement=parseInt(parseInt(nearest) + parseInt(peripheralDisplay));
					
					if ( minElement < 0) minElement =0;
					
					console.log("minElement=" + minElement + " maxElement=" + maxElement);
					for ( i=0;i<1000;i++)
					{
						if ( typeof $('.timeLine' + i) == "undefined" )
						 {
						   break;	
						 }
						if ( i >= minElement && i <= maxElement)
						{
							$('.timeLine' + i).each(function(num,val){
								 	if ( $(this).attr('src') == "" )
								     {
			   						 	$(this).attr('src', $(this).attr('name'));
									 }
									 console.log("Load video for " + i);
								});	
						}else
						{
							$('.timeLine' + i).each(function(num,val){
								     $(this).attr('src', '')
									console.log("UnLoad video for " + i);
								});	
						}
						
					}
					
				
				}
			
				function toggleMenu()
				{
					if ( displayMenu == 0 )
						{
							//$("#menu").show();
							$("#menu").transition('fly left');
							displayMenu=1;
						}else
						{
								//$("#menu").hide();
								$("#menu").transition('slide down')
								displayMenu=0;
						}
				}
			
				$("#menuDisplay").click(function(e)
					{
						toggleMenu();
					});	
		
		
			$("#setPath").click(function(e){
				
				
				
				
				$("#path").modal({
					onApprove : function() {
											// Check if docker-compose find
											getValueFromUrl("camera?action=isDockerCompose&dir=" + $("#pathHeader").html(),true,function (presence){
												if ( presence == "true")
												{
													setPath();
												}else
												{
													$("#noDockerCompose").modal({
																	onApprove : function() {
																		setPath();
																	}
																	}).modal('show');;
												}
												
												});	
										    },
					onDeny     : function () {
						$("#items").html('<div class="item"><i name="/" class="browsable folder icon"></i><div class="content"><div class="header">/</div></div></div>');
					}
				}).modal('show');
			});
	
			
		function loadStoreCamera(redraw,crunch)
		{
			
			if ( timeLineJson != ""  )
			{
				if ( redraw )
				 {
					$("html, body").animate({ scrollTop: 0 }, "slow");
					if ( crunch == "")
					{
					crunch="&startCrunch=" + (timeLineJson.startCrunch);
					}
				 }else
				 {
					if ( crunch == "")
					{
					crunch="&startCrunch=" + (timeLineJson.endCrunch);
					}				
				 }
			}
			
			getValueFromUrl("camera?action=getTimeLine" + crunch,true,function(json){
													
				try {
					$("body").find(".forceDisplay").show();
					$("body").find(".waitingPimp").hide();
					
					timeLineJson=JSON.parse(json);
					console.log(timeLineJson);
					html="<table>";
					for ( i=0;i<timeLineJson.maxLineDisplay;i++)
					{
						html+="<tr>";
						timeLine=timeLineJson.cameraToMedia[i];
						for ( k=1;k<=timeLineJson.maxColumnDisplay;k++)
						{
							
							if ( typeof timeLine[k] == "undefined" ){
								html+="<td><div class=filler style=background-color:white;width:335px; /></td>";
							}else
							{
								html+="<td >";
								 html += "<div id=\"wait_" + k + "_" + timeLine[k].time + "\" style=border-radius:5px;width:335px><i style=z-index:2000 class=\"waitingPimp notched circle loading icon\"></i></div>";
								 aDate=new Date(timeLine[k].time);
								 html += "<div class=\"dateEvt " + k + "_" + timeLine[k].time + " \" ><center>" + aDate.toLocaleDateString(undefined, options) +  "</center></div>";
						
							 	 html+="<center><button style=position:relative;display:inline;width:30%;float:left; name=\""  + k + "_" + timeLine[k].time + "\" id=\""  + timeLine[k].pathToMedia + "\" class=\"" + k + "_" + timeLine[k].time + " trainable mini teal ui labeled icon button\"><i class=\"cog icon\"></i>Train</button>";
								 html+="<button style=position:relative;display:inline;width:30%;float:left; name=\""  + k + "_" + timeLine[k].time + "\" id=\""  + timeLine[k].pathToMedia + "\" class=\"" + k + "_" + timeLine[k].time + " purgeable mini red ui labeled icon button\"><i class=\"trash icon\"></i>Purge</button>";
								 html+="<button style=position:relative;width:70px;display:inline;width:30%;float:left; name=\""  + k + "_" + timeLine[k].time + "\" id=\""  + timeLine[k].pathToMedia + "\" class=\"" + k + "_" + timeLine[k].time + " keepable mini green ui labeled icon button\"><i class=\"save icon\"></i>Keep</button></center>";
								 if ( timeLine[k].pathToMedia.endsWith(".mp4"))
									{
										 
										 html += "<video preload=\"metadata\" id=\"" + k + "_" + timeLine[k].time + "\" oncanplay=\"display('" + k +"_" + timeLine[k].time + "');\" class=\"" + k + "_" + timeLine[k].time + " videoCam timeLine" + timeLineId + " forceDisplay\" loop=\"true\" muted autoplay=\"true\" preload=\"auto\" style=display:none;border-radius:5px; width=335 controls name=\"/display?fileName=" + timeLine[k].pathToMedia + "\" src=\"/display?fileName=" + timeLine[k].pathToMedia + "&camName=" + timeLine[k].camName + "\">not loading</video>";										
									}else if (timeLine[k].pathToMedia.endsWith(".jpg"))
									{
										 //console.log(timeLine[k].pathToMedia);
										 html += "<img class=\"" + k + "_" + timeLine[k].time + " forceDisplay width=335 id=\"" + k + "_" + timeLine[k].time + "\" src=\"/display?fileName=" + timeLine[k].pathToMedia + "\" />";										
									}
								html+="</td>";
								//console.log(timeLine[k]);
							}
						}						
					html+="</tr>";
					}
					if ( redraw) 
					{
														
											$("#camContent").html(html + "</table><div name=" + timeLineId + " id=timeLineId" + timeLineId + " class=\"ui segment loadMore\" style=width:100%;height:100px>Load " + timeLineJson.maxLineDisplay +" timelines more</div>");
					}else
					{
											$("#camContent").append(html + "</table><div name=" + timeLineId + " id=timeLineId" + timeLineId + " class=\"ui segment loadMore\" style=width:100%;height:100px>Load " + timeLineJson.maxLineDisplay +" timelines more</div>");
											timeLineId++;						
					}

					setNightMode(nightMode);
				} catch (e)
				{
					console.log(e);
				}
														
			});
			
			
			
		}
		
		function loadLiveCamera()
		{
			getValueFromUrl("camera?action=getCameras",true,function(json){
													
				try {
					cameraJson=JSON.parse(json);
					console.log(cameraJson);
					html="<table><tr>";
					for ( i=0;i<cameraJson.length;i++)
					{
						camera=cameraJson[i];
						if ( camera.ip != "" && typeof camera.ip != "undefined" )
						{
							ip=camera.ip;
						}else
						{
							ip=window.location.hostname;
						}
 						html+="<td>";
							html+="<button id=\"" + camera.name + "\" class=\"seekable tiny red ui labeled icon button\"><i class=\"angle double down icon\"></i>Seek</button>";
							html+="<button id=\"" + camera.name + "\" class=\"cleanable tiny orange ui labeled icon button\"><i class=\"trash icon\"></i>Purge Files</button>";
							html+="<button class=\"tiny blue ui labeled icon button\"><i class=\"wrench icon\"></i><a target=new href=http://" + ip +":" + camera.kerberosPort + ">Settings</a></button>";
							html+="<br><a target=new href=/stream?camName=" + camera.name  + "&url=http://" + ip +":" + camera.broadcastPort + " ><img alt=\"no stream available see logs\" id=\"img_" + camera.name + "\" style=border-radius:5px;z-index:1000 width=335px src=/stream?camName=" + camera.name +"&url=http://" + ip +":" + camera.broadcastPort+"/></a>"
						html+="</td>";
					}
					$("#cameraHeader").html(html + "</tr></table>");
					
				} catch (e)
				{
					console.log(e);
				}
														
			});
		}
		
		function setPath()
		{
			
			$("#ConfirmIcon").addClass("loading");
			getValueFromUrl("camera?action=setPath&path=" + $("#pathHeader").html(),true,function(){
																$("#ConfirmIcon").removeClass("loading");
																loadLiveCamera();
																createMenu();
																loadStoreCamera(true,"");
			});
		}
			
			function reloadMemory()
			{
				
				getValueFromUrl("admin?action=getMemory",true,function (memory){
					try{
						memories=JSON.parse(memory);
						percent=parseFloat(memories.used) * 100 / parseFloat(memories.max);
						
						//console.log(percent + " " +memories.used + " " + memories.max);
						used=parseFloat(memories.used) * 1024;
						total=parseFloat(memories.max) * 1024;
						//console.log(used + " " +total);
						$('#memory')
						  .progress({
							percent: percent,
							value: used,
							total: total,
						    text: {
						      active  : 'Using {value} of {total} memory megabytes',
						    }
						  })
						;
						
					}catch (e)
					{
						console.log(e);
					}
					
				});
				
			}
			
			function reloadSpace()
			{
				
				getValueFromUrl("admin?action=getSpace",true,function (space){
					try{
						spaces=JSON.parse(space);
						percent=parseFloat(spaces.used) * 100 / parseFloat(spaces.max);
						if ( percent >= 90 )
						{
							$("#spaceWarn").show();
							
						}else
						{
							$("#spaceWarn").hide();
						}
						//console.log(percent + " " +memories.used + " " + memories.max);
						used=parseFloat(spaces.used);
						total=parseFloat(spaces.max);
						//console.log(used + " " +total);
						$('#space')
						  .progress({
							percent: percent,
							value: used,
							total: total,
						    text: {
						      active  : 'Using {value} of {total} space megabytes ({percent}%)',
						    }
						  })
						;
						
					}catch (e)
					{
						console.log(e);
					}
					
				});
				
			}
			
			

		});					
		</script>

   	</head>
	<body id=body>
	
		<div id=memoryBlock class=memory style=position:fixed;top:0px;width:100%;z-index:1000>
		    <div id=memory style=width:100% class="ui tiny indicating progress">
	  			<div class="bar"></div>
	  			<div id=memoryColor style="color:black;" class="label">Memory</div>
			</div>
		</div>
		
		<div id=spaceBlock class=memory style=position:fixed;bottom:1px;height:40px;width:100%;z-index:1000;background-color:white>
		    <div id=space style=width:100% class="ui tiny indicating progress">
	  			<div class="bar"></div>
	  			<div id=spaceColor style="color:black;" class="label">Space</div>
			</div>
		</div>
	
		 <div id=spaceWarn style=display:none;position:fixed;bottom:25px;height:25px;right:2px;z-index:1000; class="tiny ui red basic label">
      					Kerberos.io starts going mad by deleting all files because you're upper 90%, make some clean
    	 </div>
	
	
		<button id=menuDisplay style=position:fixed;z-index:2000;right:-4px;top:5px;height:37px class="big ui icon button">
  			<i class="bars icon"></i>
		</button>
		
		
		
		<div id=menu style=display:none;position:fixed;z-index:20000;right:-4px;top:43px; class="ui small compact vertical labeled icon menu">
			  <a class="item">
			    <i id=setPath class="home icon"></i>
			    Set kerberos.io path
			  </a>
			  <a class="item">
			    <i onclick=javascript:window.open('https://github.com/coxifred/PimpMyKerberos') class="github icon"></i>
			   PimpMyKerberos
			  </a>
			  <a class="item">
			    <i id=showChart class="chart line icon"></i>
			   Graphical Highlights
			  </a>
			  <a class="item">
				<i id=cleanAll class="trash icon"></i>
			   	Clean old files
			  </a>
	 		  <a class="item">
				<i id=keep class="save icon"></i>
			   	Keep files
			  </a>
			  <a class="item">
				<i onclick=javascript:window.open('admin?action=save') id=save class="save icon"></i>
			   	Save config
			  </a>
			  <a class="item">
				<i id=dash class="desktop icon"></i>
			   	Dashcam
			  </a>
			  <a class="item">
				<i id=ai class="cog icon"></i>
			   	Ai Training
			  </a>
	 		  <a class="item">
				<i onclick=javascript:window.open('admin?action=getLogs') id=logs class="archive icon"></i>
			   	Logs
			  </a>
	 		  <a class="item">
					<div style=position:absolute;left:3px id=muteCheck class="ui toggle checkbox">
					  <input type="checkbox" name="public">
					  <label>Mute</label>
					</div>
										<br><br>
			  </a>
	 		  <a class="item">
					<div style=position:absolute;left:3px id=nightCheck class="ui toggle checkbox">
					  <input type="checkbox" name="public">
					  <label>Night mode</label>
					</div>
					<br><br>
			  </a>
			<a id=paypal class="item">
				
 		    </a>
				
	
			  <a class="item">
			    <i id=logout class="power off icon"></i>
			    Logout
			  </a>
			</div>
		
		
	
		<div id=time style=position:fixed;z-index:1000;top:15px;left:2px;color:white></div> 
		<div style=position:fixed;z-index:1000;top:5px;right:50px class="ui calendar" >
			    <div class="ui input left icon">
			      <i class="calendar icon"></i>
			      	<input type="text" placeholder="Date" id="calendar">
			    </div>
			</div>
			

 			
	<div id=frontal>
		<div id=cameraHeader style=position:fixed;z-index:1000;top:44px;margin-left:20px;margin-right:20px;width:100%>
		
		</div>
		
		
		<div id=fond style=position:fixed;z-index:500;top:0px;height:350px;width:100%;background-color:white;>
		
		</div>
			
		
		
		<div id=camContent style=position:relative;top:420px;margin-left:25px;margin-right:24px;width:100%;left:-3px;height:100%;background-color:white; >
		  
		</div>
	</div>
	
	<div id=dashcam>
		
	</div>
	
	<div id=dashai style=position:fixed;display:none;top:42px;width:100%;height:100%;background-color:white;z-index:5000 >
	
					<div class="ui menu">
					  <div class="item">
					    <div id=trainModelButton class="ui olive button">Train model</div>
					  </div>
					  <div class="item">
					    <div id=engineButton class="ui blue button">Display engine training</div>
					  </div>
					  <div class="item">
					    <div id=closeDashAI class="ui button">Close</div>
					  </div>
					</div>
		<div id=trainModel>
			<div style=position:relative;top:-15px class="ui vertical menu">
								  <div class="item">
									 
								    <button class="tiny ui button"><i class="icon plus"></i>Add new model</button>
								  </div>
								  <div id=items>
									  <div class="item">
									    <i class="microchip icon"></i> Chat
									    <div class="menu">
									      <a class="item">Delete</a>
									      <a class="item">Edit</a>
									    </div>
									  </div>
								  </div>
			</div>
			
			
			
			
			
		</div>
	
			
					
					
	</div>
	
	
<div id=path class="ui modal">
  <i class="close icon"></i>
  <div id=pathHeader class="header">
    Point to kerberos.io directory containing docker-compose.yml
  </div>
  <div class="image content">
    <div class="description">
				  <div id=items class="ui list">
				  	<div class="item">
				    	<i name="/" class="browsable folder icon"></i>
				    	<div class="content">
				      		<div class="header">/</div>
				    	</div>
				  	</div>  
				  </div>
    </div>
  </div>
  <div class="actions">
	<div class="ui black deny button">
      Return at the top
    </div>
    <div id=Confirm class="ui positive right labeled icon button">
      Confirm
      <i id=ConfirmIcon class="checkmark icon"></i>
    </div>
  </div>
</div>
	
<div id=noDockerCompose class="tiny ui modal">
  <div class="header">No docker-compose.yml file found</div>
  <div class="content">
    <p>Continue ?</p>
  </div>
  <div class="actions">
    <div class="ui approve button">Yes</div>
    <div class="ui cancel button">Cancel</div>
  </div>
</div>


<div id=disconnect class="ui basic modal">
  <div class="ui icon header">
    <i class="plug icon"></i>
    Lost Connection/Disconnected, please click when ok
  </div>
  <div class="content">
   		<center><img style=position:relative;top:200px height=40% src=images/wolf.png><center>
		<div style=position:relative;bottom:-300px;right:2px; class="footer">A product by <img style=position:relative;top:32px height=64px src=images/bab.png><a href=https://github.com/coxifred>Coxifred</a></div>
  </div>
  <div class="actions">
    <div class="ui green ok inverted button">
      <i class="checkmark icon"></i>
      Ack
    </div>
  </div>
</div>


<div style=position:fixed;display:none;bottom:45px;right:5px;z-index:3000;width:400px;border-radius:5px; id=reloadMessage class="ui icon message">
  <i class="eye icon"></i>
  <div class="content">
    <div class="header">
      New Detection
    </div>
    <p><div id=messageDetail>Detection from camera_allee</div></p>
	<div id=reloadButton class="ui basic green button">Reload</div>
	<div id=muteButton class="ui basic orange button">Mute</div>
	<div id=declineButton class="ui basic red button">Decline</div>
  </div>
</div>

<div id=purgeCount class="tiny ui modal">
  <div class="header">Purge</div>
  <div class="content">
    <p><div id=purgeCounter></div></p>
  </div>
  <div class="actions">
    <div class="ui approve button">Approve</div>
  </div>
</div>

<div id=showChartModal style=display:none;z-index:3000;width:100%;height:420px;top:0px;position:fixed; >
  <div id=canvasContent style=height:600px;width:100% class="content">
    <canvas id="myChart" width="800" height="170"></canvas>
  </div>
  <div id=hideChartModal style=position:relative;top:-300px class="tiny teal ui approve button">Hide</div>
  
</div>


</body>
</html>
